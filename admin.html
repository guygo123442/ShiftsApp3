<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מנהלים - משמרות</title>
<style>
  table { border-collapse: collapse; width: 100%; text-align: center; margin-top: 20px; }
  th, td { border: 1px solid #333; padding: 10px; }
  th { background-color: #555; color: white; }
  tr:nth-child(even) { background-color: #f2f2f2; }
  td { min-width: 100px; }
  button { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
</style>
</head>
<body>
<h2>כל ההגשות</h2>

<table id="shiftsTable">
  <thead>
    <tr>
      <th>משמרת</th>
      <th>ראשון</th>
      <th>שני</th>
      <th>שלישי</th>
      <th>רביעי</th>
      <th>חמישי</th>
      <th>מוצ״ש</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="resetShifts()">איפוס כל המשמרות</button>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbw0ZX_KegPYG7lxDJ6xNTY5rt1LmpuhfIofCZop63MJyEccjb8LVY-8fPEnYp2M35LP/exec";
const shifts = ["דלפק בוקר","מטבח בוקר","דלפק ערב","מטבח ערב"];
const days = ["ראשון","שני","שלישי","רביעי","חמישי","מוצ״ש"];

function loadSubmissions() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(submissions => {
      const tbody = document.querySelector("#shiftsTable tbody");
      tbody.innerHTML = "";

      shifts.forEach(shift => {
        const row = document.createElement("tr");
        const shiftCell = document.createElement("td");
        shiftCell.textContent = shift;
        row.appendChild(shiftCell);

        days.forEach(day => {
          const cell = document.createElement("td");
          const names = submissions
            .filter(s => s.shift === shift && s.day === day)
            .map(s => s.user);
          cell.textContent = names.join(", ");
          row.appendChild(cell);
        });

        tbody.appendChild(row);
      });
    })
    .catch(err => console.error("שגיאה ב-fetch:", err));
}

function resetShifts() {
  if(confirm("אתה בטוח שאתה רוצה לאפס את כל המשמרות?")) {
    fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ action: "reset" }),
      headers: { "Content-Type": "application/json" }
    })
    .then(res => res.json())
    .then(data => {
      if(data.status==="ok") {
        alert("כל המשמרות אופסו!");
        loadSubmissions();
      } else {
        alert("שגיאה באיפוס המשמרות");
      }
    })
    .catch(err => console.error("שגיאה ב-fetch:", err));
  }
}

loadSubmissions();
</script>
</body>
</html>
